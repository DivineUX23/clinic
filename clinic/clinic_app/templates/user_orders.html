{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container py-3">

    <div class="search-page-header">
        <div>
            <h5 class="font-semibold mb-1">Orders</h5>
            <!--<div class="view-page-item-count">{{ total }} product{{ total|pluralize }} in catalog</div>-->
        </div>
        <form id="search-form" class="d-none d-lg-block" >
            <div class="sorting-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="21" viewBox="0 0 20 21" fill="none">
                    <!-- SVG path data here -->
                </svg>
                <label class="for-shoting" for="sorting">
                    <span>Sort by</span>
                </label>
                        
                <select id="sort-select" class="px-4 py-2 rounded-md bg-gray-200 text-gray-700" onchange="this.options[this.selectedIndex].value && (window.location = this.options[this.selectedIndex].value);">
                    <option value="?sort=-created_at{% if status_filter != 'all' %}&status={{ status_filter }}{% endif %}" {% if sort_by == '-created_at' %}selected{% endif %}>Newest First</option>
                    <option value="?sort=created_at{% if status_filter != 'all' %}&status={{ status_filter }}{% endif %}" {% if sort_by == 'created_at' %}selected{% endif %}>Oldest First</option>
                    <option value="?sort=-total_amount{% if status_filter != 'all' %}&status={{ status_filter }}{% endif %}" {% if sort_by == '-total_amount' %}selected{% endif %}>Highest Amount</option>
                    <option value="?sort=total_amount{% if status_filter != 'all' %}&status={{ status_filter }}{% endif %}" {% if sort_by == 'total_amount' %}selected{% endif %}>Lowest Amount</option>
                </select>
            </div>
        </form>
        <!-- Mobile sorting and filter buttons -->
        <div class="d-lg-none">
            <button class="btn btn-outline-secondary mr-2" data-toggle="modal" data-target="#sortingModal">
                Sort
            </button>
            <button class="btn btn-outline-secondary" data-toggle="modal" data-target="#filterModal">
                Filter
            </button>
        </div>
    </div>
</div>
    

<div class="container py-3">
    <div class="row">
      <!-- Sidebar -->
      <aside class="col-lg-2 col-md-3 col-sm-4 hidden-xs SearchParameters" id="SearchParameters">

            <div class="cz-sidebar" id="shop-sidebar">
                <div class="cz-sidebar-header bg-light">
                    <button class="close ml-auto" type="button" data-dismiss="sidebar" aria-label="Close">
                        <i class="tio-clear"></i>
                    </button>
                </div>
                <!-- Categories -->
                <div class="mt-3 __cate-side-arrordion">
                    <div class="text-center __cate-side-title">
                        <span class="widget-title font-semibold">Filter</span>
                    </div>
                    <div class="accordion mt-n1 __cate-side-price" id="shop-categories">
                   

                        <div class="menu--caret-accordion">
                            <div class="card-header flex-between">
                                <a href="?status=all{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="px-4 py-2 rounded-md {% if status_filter == 'all' %}bg-purple btn-purple text-white{% else %}bg-gray-200 text-gray-700{% endif %}">All</a>
                                </div>
                        </div>


                        <div class="menu--caret-accordion">
                            <div class="card-header flex-between">
                                <a href="?status=pending{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="px-4 py-2 rounded-md {% if status_filter == 'pending' %}bg-purple btn-purple text-white{% else %}bg-gray-200 text-gray-700{% endif %}">Pending</a>
                                </div>
                        </div>

                        <div class="menu--caret-accordion">
                            <div class="card-header flex-between">
                                <a href="?status=completed{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="px-4 py-2 rounded-md {% if status_filter == 'completed' %}bg-purple btn-purple text-white{% else %}bg-gray-200 text-gray-700{% endif %}">Completed</a>
                            </div>
                        </div>

                        <div class="menu--caret-accordion">
                            <div class="card-header flex-between">
                                <a href="?status=failed{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="px-4 py-2 rounded-md {% if status_filter == 'failed' %}bg-purple btn-purple text-white{% else %}bg-gray-200 text-gray-700{% endif %}">Failed</a>
                            </div>
                        </div>


                </div>
            </div>
        </aside>


        <section class="col-lg-9">
            <div class="row" id="products-container">
            {% if page_obj %}
                <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                    {% for order in page_obj %}
                        <div class="bg-white rounded-lg shadow-md overflow-hidden">
                            <div class="p-6">
                                <h2 class="text-xl font-semibold text-gray-800 mb-2">Order #{{ order.id }}</h2>
                                <p class="text-sm text-gray-600 mb-4">Placed on: {{ order.created_at|date:"F j, Y" }}</p>
                                
                                <div class="mb-4">
                                    <p class="text-gray-700"><strong>Total Amount:</strong> ${{ order.total_amount }}</p>
                                    <p class="text-gray-700"><strong>Status:</strong> {{ order.status|title }}</p>
                                    {% if order.shipment_status %}
                                        <p class="text-gray-700"><strong>Shipment Status:</strong> {{ order.shipment_status|title }}</p>
                                    {% endif %}
                                </div>
                                
                                {% if order.shipment_order_id %}
                                    <div class="mb-4">
                                        <p class="text-gray-700"><strong>Tracking Code:</strong> {{ order.shipment_order_id }}</p>
                                        <p class="text-gray-700"><strong>Courier:</strong> {{ order.courier_name }}</p>
                                    </div>
                                    
                                    {% if order.tracking_url %}
                                        <a href="{{ order.tracking_url }}" target="_blank" class="inline-flex items-center px-4 py-2 bg-purple btn-purple text-white rounded-md">
                                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                                            </svg>
                                            Track Shipment
                                        </a>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
                    
                <!-- Pagination -->
                <br>
                        <!-- Pagination -->
                        <div class="col-12">
                            <nav class="d-flex justify-content-center pt-2" aria-label="Page navigation" id="paginator-ajax">
                                {% if is_paginated %}
                                    <ul class="pagination">
                                        {% if page_obj.has_previous %}
                                            <li class="page-item">
                                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
                                                    <span aria-hidden="true">&laquo;</span>
                                                </a>
                                            </li>
                                        {% endif %}
            
                                        {% for num in page_obj.paginator.page_range %}
                                            {% if page_obj.number == num %}
                                                <li class="page-item active"><a class="page-link" href="#">{{ num }}</a></li>
                                            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                                <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                                            {% endif %}
                                        {% endfor %}
            
                                        {% if page_obj.has_next %}
                                            <li class="page-item">
                                                <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
                                                    <span aria-hidden="true">&raquo;</span>
                                                </a>
                                            </li>
                                        {% endif %}
                                    </ul>
                                {% endif %}
                            </nav>
                        </div>
                    <br>
                <br>

            {% else %}
                <p class="text-gray-600">You haven't placed any orders yet.</p>
            {% endif %}
            </div>
        </section>

    </div>
</div>




















  <!-- Mobile Sorting Modal -->
  <div class="modal fade" id="sortingModal" tabindex="-1" role="dialog" aria-labelledby="sortingModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="sortingModalLabel">Sort Products</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                
                <select id="sort-select" class="px-4 py-2 rounded-md bg-gray-200 text-gray-700" onchange="this.options[this.selectedIndex].value && (window.location = this.options[this.selectedIndex].value);">
                    <option value="?sort=-created_at{% if status_filter != 'all' %}&status={{ status_filter }}{% endif %}" {% if sort_by == '-created_at' %}selected{% endif %}>Newest First</option>
                    <option value="?sort=created_at{% if status_filter != 'all' %}&status={{ status_filter }}{% endif %}" {% if sort_by == 'created_at' %}selected{% endif %}>Oldest First</option>
                    <option value="?sort=-total_amount{% if status_filter != 'all' %}&status={{ status_filter }}{% endif %}" {% if sort_by == '-total_amount' %}selected{% endif %}>Highest Amount</option>
                    <option value="?sort=total_amount{% if status_filter != 'all' %}&status={{ status_filter }}{% endif %}" {% if sort_by == 'total_amount' %}selected{% endif %}>Lowest Amount</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Mobile Filter Modal -->
<div class="modal fade" id="filterModal" tabindex="-1" role="dialog" aria-labelledby="filterModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="filterModalLabel">Filter Products</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div>
                    <div id="mobile-categories-accordion">
                     

                        <div class="menu--caret-accordion">
                            <div class="card-header flex-between">
                                <a href="?status=all{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="px-4 py-2 rounded-md {% if status_filter == 'all' %}bg-purple btn-purple text-white{% else %}bg-gray-200 text-gray-700{% endif %}">All</a>
                                </div>
                        </div>


                        <div class="menu--caret-accordion">
                            <div class="card-header flex-between">
                                <a href="?status=pending{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="px-4 py-2 rounded-md {% if status_filter == 'pending' %}bg-purple btn-purple text-white{% else %}bg-gray-200 text-gray-700{% endif %}">Pending</a>
                                </div>
                        </div>

                        <div class="menu--caret-accordion">
                            <div class="card-header flex-between">
                                <a href="?status=completed{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="px-4 py-2 rounded-md {% if status_filter == 'completed' %}bg-purple btn-purple text-white{% else %}bg-gray-200 text-gray-700{% endif %}">Completed</a>
                            </div>
                        </div>

                        <div class="menu--caret-accordion">
                            <div class="card-header flex-between">
                                <a href="?status=failed{% if sort_by %}&sort={{ sort_by }}{% endif %}" class="px-4 py-2 rounded-md {% if status_filter == 'failed' %}bg-purple btn-purple text-white{% else %}bg-gray-200 text-gray-700{% endif %}">Failed</a>
                            </div>
                        </div>





                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}